/* チャットコンテナの見た目 */
.chat-container {
    background-color: var(--background-primary);
}

.chat-messages {
    background-color: var(--background-primary);
    padding: var(--spacing-lg);
    gap: var(--spacing-md);
}

/* ===== メッセージスタイル（吹き出し風） ===== */
.message {
    display: flex;
    gap: 12px;
    max-width: 85%;
    position: relative;
    padding: 8px 24px;
}

/* ユーザーメッセージ: 右寄せ */
.message.user {
    margin-left: auto;
    flex-direction: row-reverse;
}

/* AIメッセージ: 左寄せ */
.message.bot {
    margin-right: auto;
}

/* アバター（文字ベース） */
.message-avatar {
    width: var(--avatar-size);
    height: var(--avatar-size);
    border-radius: 50%;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: 700;
    color: #ffffff;
    text-transform: uppercase;
}

/* ユーザーアバター */
.message-avatar.avatar-user {
    background-color: var(--avatar-user-bg);
}

/* OpenAI/GPTアバター */
.message-avatar.avatar-openai {
    background-color: var(--avatar-openai-bg);
}

/* Claudeアバター */
.message-avatar.avatar-claude {
    background-color: var(--avatar-claude-bg);
}

/* Geminiアバター */
.message-avatar.avatar-gemini {
    background-color: var(--avatar-gemini-bg);
}

/* デフォルトアバター */
.message-avatar.avatar-default {
    background-color: var(--text-tertiary);
}

/* メッセージボディ（吹き出し） */
.message-body {
    flex: 1;
    min-width: 0;
    background: var(--bot-message-bg);
    border-radius: var(--message-border-radius);
    padding: 12px 16px;
}

.message.user .message-body {
    background: var(--user-message-bg);
    border-radius: var(--message-border-radius);
}

/* メッセージヘッダー */
.message-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 6px;
}

.message-sender {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary);
}

.message-timestamp {
    font-size: 11px;
    color: var(--text-tertiary);
    font-weight: normal;
}

/* メッセージコンテンツ */
.message-content {
    position: relative;
    font-size: 15px;
    line-height: 1.6;
    color: var(--text-primary);
}

/* メッセージの添付ファイル表示 */
.message-attachments {
    margin-top: var(--spacing-sm);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

.attachment-image-container {
    max-width: 100%;
    border-radius: var(--border-radius-md);
    overflow: hidden;
}

.attachment-image {
    max-width: 100%;
    height: auto;
    display: block;
}

.attachment-file-name {
    font-size: var(--font-size-sm);
    color: var(--text-primary);
    word-break: break-all;
}

/* ===== メッセージアクション ===== */
.message-actions {
    display: flex;
    gap: 4px;
    margin-top: 10px;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.message:hover .message-actions {
    opacity: 1;
}

.action-btn {
    padding: 5px 8px;
    border: none;
    background: transparent;
    color: var(--text-tertiary);
    cursor: pointer;
    border-radius: 4px;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 4px;
    transition: all 0.15s ease;
}

.action-btn:hover {
    background: var(--background-quaternary);
    color: var(--text-primary);
}

.action-btn.active {
    color: var(--accent-color);
}

.action-btn i {
    font-size: 13px;
}

/* コピーボタン（レガシー対応） */
.copy-button {
    display: none;
}

/* ===== 編集モード ===== */
.message.editing .message-content {
    display: none;
}

.message.editing .message-actions {
    display: none;
}

.message-edit-container {
    width: 100%;
}

.message-edit-textarea {
    width: 100%;
    min-height: 80px;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 14px;
    line-height: 1.5;
    font-family: inherit;
    resize: vertical;
    background: var(--background-tertiary);
    color: var(--text-primary);
}

.message-edit-textarea:focus {
    outline: none;
    border-color: var(--accent-color);
}

.message-edit-actions {
    display: flex;
    gap: 8px;
    margin-top: 10px;
    justify-content: flex-end;
}

.edit-save-btn,
.edit-cancel-btn {
    padding: 6px 14px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.15s ease;
}

.edit-save-btn {
    background: var(--accent-color);
    color: #ffffff;
    border: none;
}

.edit-save-btn:hover {
    background: var(--accent-hover-color);
}

.edit-cancel-btn {
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
}

.edit-cancel-btn:hover {
    background: var(--background-tertiary);
    color: var(--text-primary);
}

/* ===== リアクション ===== */
.reaction-btn.liked {
    color: var(--accent-color);
}

.reaction-btn.disliked {
    color: var(--error-color);
}

/* ===== ファイルプレビュー ===== */
.file-preview {
    display: none;
    position: absolute;
    visibility: hidden;
    height: 0;
    overflow: hidden;
    opacity: 0;
}

.file-preview:not(:empty) {
    position: static;
    visibility: visible;
    height: auto;
    opacity: 1;
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
    padding: var(--spacing-xs) 0;
    border-top: 1px solid var(--border-color);
    margin-top: var(--spacing-xs);
    padding-top: var(--spacing-sm);
}

.file-preview-item {
    display: flex;
    align-items: center;
    background-color: var(--background-quaternary);
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--border-radius-sm);
    font-size: var(--font-size-sm);
    color: var(--text-primary);
}

.file-preview-item .remove-file {
    margin-left: var(--spacing-xs);
    cursor: pointer;
    color: var(--text-tertiary);
}

.file-preview-item .remove-file:hover {
    color: var(--error-color);
}

/* ===== コードブロック ===== */
.message .markdown-content pre {
    background-color: #1e1e1e;
    margin: 12px 0;
    padding: 14px;
    overflow-x: auto;
    font-size: 13px;
    line-height: 1.5;
    border-radius: 8px;
    border: 1px solid #3d3d3d;
}

.message .markdown-content pre code {
    background-color: transparent;
    padding: 0;
    color: #d4d4d4;
    font-size: 1em;
    font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
}

.message .markdown-content code {
    background-color: var(--background-quaternary);
    border-radius: 4px;
    font-size: 13px;
    padding: 2px 5px;
    font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
    color: var(--text-primary);
}

/* コードブロックラッパー */
.code-block {
    position: relative;
    margin: 12px 0;
}

.code-language {
    background: #2d2d2d;
    color: #9ca3af;
    padding: 6px 10px;
    font-size: 11px;
    border-radius: 8px 8px 0 0;
    border: 1px solid #3d3d3d;
    border-bottom: none;
}

.code-block pre {
    margin-top: 0 !important;
    border-radius: 0 0 8px 8px !important;
}

.code-block-toolbar {
    position: absolute;
    top: 6px;
    right: 6px;
    display: flex;
    gap: 4px;
    z-index: 10;
}

.code-copy-button,
.code-edit-button,
.code-execute-button,
.artifact-open-button {
    padding: 5px 8px;
    border: none;
    background: rgba(255, 255, 255, 0.1);
    color: #9ca3af;
    cursor: pointer;
    border-radius: 4px;
    font-size: 11px;
    transition: all 0.15s ease;
}

.code-copy-button:hover,
.code-edit-button:hover,
.code-execute-button:hover,
.artifact-open-button:hover {
    background: rgba(255, 255, 255, 0.2);
    color: #ffffff;
}

.code-copy-button.copied {
    background: var(--accent-color);
    color: #ffffff;
}

.code-execute-button {
    background: rgba(16, 163, 127, 0.2);
}

.code-execute-button:hover {
    background: rgba(16, 163, 127, 0.4);
}

/* シンタックスハイライト */
.message .markdown-content .token.comment,
.message .markdown-content .token.prolog,
.message .markdown-content .token.doctype,
.message .markdown-content .token.cdata {
    color: #6a9955;
}

.message .markdown-content .token.string,
.message .markdown-content .token.attr-value {
    color: #ce9178;
}

.message .markdown-content .token.punctuation {
    color: #d4d4d4;
}

.message .markdown-content .token.operator {
    color: #d4d4d4;
}

.message .markdown-content .token.keyword {
    color: #569cd6;
}

.message .markdown-content .token.function {
    color: #dcdcaa;
}

.message .markdown-content .token.number {
    color: #b5cea8;
}

/* ===== タイピングインジケーター ===== */
.typing-indicator .message-content {
    display: flex;
    align-items: center;
}

.typing-indicator .message-content p {
    margin-right: var(--spacing-sm);
}

.typing-dots {
    display: inline-flex;
    gap: 4px;
    margin-left: 4px;
}

.typing-dots span {
    width: 6px;
    height: 6px;
    background-color: var(--text-tertiary);
    border-radius: 50%;
    animation: typingDot 1.4s infinite;
    opacity: 0.4;
}

.typing-dots span:nth-child(1) {
    animation-delay: 0s;
}

.typing-dots span:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-dots span:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes typingDot {
    0%, 100% {
        opacity: 0.4;
        transform: scale(1);
    }
    50% {
        opacity: 1;
        transform: scale(1.2);
    }
}

/* カーソル点滅 */
.markdown-content.typing::after {
    content: "|";
    display: inline-block;
    animation: cursorBlink 0.8s infinite;
    font-weight: normal;
    color: var(--text-tertiary);
}

@keyframes cursorBlink {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0;
    }
}

/* ===== ファイルアップロード ===== */
.file-upload-label {
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    padding: var(--spacing-xs) var(--spacing-sm);
    color: var(--text-secondary);
    transition: color var(--transition-fast);
}

.file-upload-label:hover {
    color: var(--text-primary);
}

.file-upload-label input[type="file"] {
    display: none;
}

/* ===== エラーメッセージ ===== */
.message.error .message-content {
    background-color: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 8px;
    padding: 12px;
}

.error-action {
    margin-top: var(--spacing-sm);
    padding: var(--spacing-xs) var(--spacing-sm);
    background-color: var(--background-tertiary);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    color: var(--text-primary);
    cursor: pointer;
}

.error-action:hover {
    background-color: var(--background-quaternary);
}

/* ===== Mermaid図表示 ===== */
.mermaid-wrapper {
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin: 12px 0;
    overflow: hidden;
}

.mermaid-toolbar {
    padding: var(--spacing-sm);
    border-bottom: 1px solid var(--border-color);
    background-color: var(--background-secondary);
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-sm);
}

.mermaid-preview-toggle,
.mermaid-download {
    padding: var(--spacing-xs) var(--spacing-sm);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    background-color: var(--background-primary);
    color: var(--text-primary);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: var(--font-size-sm);
    transition: all var(--transition-fast) ease;
}

.mermaid-preview-toggle:hover,
.mermaid-download:hover {
    background-color: var(--background-tertiary);
    border-color: var(--border-color-hover);
}

.mermaid-code-container,
.mermaid-diagram {
    padding: var(--spacing-lg);
}

.mermaid-code-container pre {
    margin: 0;
}

.mermaid-diagram.hidden,
.mermaid-code-container.hidden {
    display: none;
}

.mermaid-loading {
    padding: var(--spacing-lg);
    text-align: center;
    color: var(--text-tertiary);
}

.mermaid-loading i {
    margin-right: var(--spacing-sm);
}

.mermaid-download i {
    font-size: var(--font-size-sm);
}

.mermaid-error {
    padding: var(--spacing-lg);
    color: var(--error-color);
    background-color: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: var(--border-radius-sm);
    margin: var(--spacing-sm);
}

.mermaid-error .error-message {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.error-details {
    margin-top: var(--spacing-sm);
    padding: var(--spacing-sm);
    background-color: var(--background-secondary);
    border-radius: var(--border-radius-sm);
    font-size: var(--font-size-sm);
    white-space: pre-wrap;
}

/* ===== Web情報取得中表示 ===== */
.web-fetch-loading {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin: 8px 0;
    padding: 8px 12px;
    background-color: var(--background-tertiary);
    border-radius: 6px;
    font-size: 13px;
    color: var(--text-secondary);
}

.web-fetch-loading p {
    margin: 0;
    display: flex;
    align-items: center;
}

.web-fetch-loading .typing-dots {
    display: inline-flex;
    margin-left: 4px;
}

/* ===== 思考過程コンテナ ===== */
.thinking-process {
    margin-bottom: 12px;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
}

.thinking-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: var(--background-tertiary);
    cursor: pointer;
    user-select: none;
    transition: background 0.15s ease;
}

.thinking-header:hover {
    background: var(--background-quaternary);
}

.thinking-toggle {
    font-size: 10px;
    color: var(--text-tertiary);
    transition: transform 0.2s ease;
}

.thinking-process[data-collapsed="false"] .thinking-toggle {
    transform: rotate(90deg);
}

.thinking-title {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
}

.thinking-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    background: var(--background-secondary);
}

.thinking-process[data-collapsed="false"] .thinking-content {
    max-height: 500px;
    overflow-y: auto;
}

.thinking-item {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    padding: 8px 12px;
    border-top: 1px solid var(--border-color);
    font-size: 12px;
    color: var(--text-secondary);
}

.thinking-item-icon {
    flex-shrink: 0;
}

.thinking-item-text {
    flex: 1;
}

/* ===== システムメッセージ ===== */
.message.bot.system-message {
    background: transparent;
    max-width: 100%;
    padding: 8px 24px;
}

.message.bot.system-message .message-body {
    background-color: var(--background-tertiary);
    padding: 10px 14px;
    border-radius: 8px;
}

/* ===== レスポンシブ ===== */
@media (max-width: 768px) {
    .message {
        padding: 8px 12px;
        max-width: 92%;
    }

    .message-body {
        max-width: 100%;
    }

    .message-actions {
        opacity: 1;
    }

    .code-block-toolbar {
        position: static;
        margin-top: 8px;
        justify-content: flex-end;
    }
}

@media (max-width: 480px) {
    .message {
        padding: 6px 8px;
        gap: 8px;
        max-width: 95%;
    }

    .message-avatar {
        width: 26px;
        height: 26px;
        font-size: 11px;
    }

    .message-body {
        padding: 10px 12px;
    }

    .message-content {
        font-size: 14px;
    }

    .action-btn {
        padding: 4px 6px;
        font-size: 11px;
    }
}

/* ===== reduced-motion対応 ===== */
@media (prefers-reduced-motion: reduce) {
    .typing-dots span,
    .markdown-content.typing::after,
    .thinking-content,
    .thinking-toggle {
        animation: none !important;
        transition: none !important;
    }
}
